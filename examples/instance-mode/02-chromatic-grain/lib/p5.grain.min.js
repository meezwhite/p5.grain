/**!
 * p5.grain
 * 
 * @version 0.7.0
 * @license MIT
 * @copyright meezwhite, Gorilla Sun
 */
class P5Grain{version="0.7.0";instance;#t;#i;#n;constructor(){this.#t=Math.random,this.#i={frameCount:0},this.#n={frameCount:0,tX_anchor:0,tX:0,tY:0}}setup(t){void 0===t?this.#t=random:"object"==typeof t&&("function"==typeof t.random&&(this.#t=t.random),"object"==typeof t.instance&&(this.instance=t.instance))}granulateSimple(t,i,n){this.applyMonochromaticGrain(t,i,n)}applyMonochromaticGrain(t,i,n){const e=this.instance?this.instance.round(t):round(t),a=i||!1;n?n.loadPixels():this.instance?this.instance.loadPixels():loadPixels();const s=n?n.pixelDensity():this.instance?this.instance.pixelDensity():pixelDensity(),r=(n?n.width:this.instance?this.instance.width:width)*s*4*((n?n.height:this.instance?this.instance.height:height)*s),h=n?n.pixels:this.instance?this.instance.pixels:pixels;for(let t=0;t<r;t+=4){const i=this.#e(-e,e);h[t]=h[t]+i,h[t+1]=h[t+1]+i,h[t+2]=h[t+2]+i,a&&(h[t+3]=h[t+3]+i)}n?n.updatePixels():this.instance?this.instance.updatePixels():updatePixels()}granulateChannels(t,i,n){this.applyChromaticGrain(t,i,n)}applyChromaticGrain(t,i,n){const e=this.instance?this.instance.round(t):round(t),a=i||!1;n?n.loadPixels():this.instance?this.instance.loadPixels():loadPixels();const s=n?n.pixelDensity():this.instance?this.instance.pixelDensity():pixelDensity(),r=(n?n.width:this.instance?this.instance.width:width)*s*4*((n?n.height:this.instance?this.instance.height:height)*s),h=n?n.pixels:this.instance?this.instance.pixels:pixels;for(let t=0;t<r;t+=4)h[t]=h[t]+this.#e(-e,e),h[t+1]=h[t+1]+this.#e(-e,e),h[t+2]=h[t+2]+this.#e(-e,e),a&&(h[t+3]=h[t+3]+this.#e(-e,e));n?n.updatePixels():this.instance?this.instance.updatePixels():updatePixels()}tinkerPixels(t,i,n){i=!1!==i,n?n.loadPixels():this.instance?this.instance.loadPixels():loadPixels();const e=n?n.pixelDensity():this.instance?this.instance.pixelDensity():pixelDensity(),a=(n?n.width:this.instance?this.instance.width:width)*e*4*((n?n.height:this.instance?this.instance.height:height)*e);for(let i=0;i<a;i+=4)t(i,a);i&&(n?n.updatePixels():this.instance?this.instance.updatePixels():updatePixels())}loopPixels(t,i){this.tinkerPixels(t,!1,i)}textureAnimate(t,i){const n=i&&i.atFrame?this.instance?this.instance.round(i.atFrame):round(i.atFrame):2;if(this.#i.frameCount+=1,this.#i.frameCount>=n){const n=i&&i.amount?this.instance?this.instance.round(i.amount):round(i.amount):this.instance?this.instance.min(this.instance.width,this.instance.height):min(width,height),e=this.#t()*n,a=this.#t()*n,s=this.instance?this.instance.floor(e):floor(e),r=this.instance?this.instance.floor(a):floor(a),h=`${s}px ${r}px`;t instanceof HTMLElement?t.style.backgroundPosition=h:t instanceof SVGElement?(t.style.top=-r+"px",t.style.left=-s+"px"):t instanceof p5.Element&&t.style("background-position",h),this.#i.frameCount=0}}textureOverlay(t,i,n){const e=n instanceof p5.Graphics,a=e?n.width:this.instance?this.instance.width:width,s=e?n.height:this.instance?this.instance.height:height,r=i&&i.mode?i.mode:this.instance?this.instance.MULTIPLY:MULTIPLY,h=!(!i||!i.reflect)&&i.reflect,o=!(!i||!i.animate)&&i.animate,c=i&&i.animate&&i.animate.atFrame?this.instance?this.instance.round(i.animate.atFrame):round(i.animate.atFrame):2,l=i&&i.animate&&i.animate.amount?this.instance?this.instance.round(i.animate.amount):round(i.animate.amount):this.instance?this.instance.min(a,s):min(a,s),p=i&&"number"==typeof i.width?i.width:t.width,u=i&&"number"==typeof i.height?i.height:t.height;if(o&&(this.#n.frameCount+=1,this.#n.frameCount>=c)){const t=this.#t()*l,i=this.#t()*l;this.#n.tX_anchor=this.instance?-this.instance.floor(t):-floor(t),this.#n.tY=this.instance?-this.instance.floor(i):-floor(i),this.#n.frameCount=0}let m=this.#n.tX_anchor,d=this.#n.tY,x=!0,g=!0;for(n?n.blendMode(r):this.instance?this.instance.blendMode(r):blendMode(r);d<s;){for(;m<a;){if(h?(e?n.push():this.instance?this.instance.push():push(),x?g?e?n.image(t,m,d,p,u):this.instance?this.instance.image(t,m,d,p,u):image(t,m,d,p,u):e?(n.scale(-1,1),n.image(t,-m,d,-p,u)):this.instance?(this.instance.scale(-1,1),this.instance.image(t,-m,d,-p,u)):(scale(-1,1),image(t,-m,d,-p,u)):g?e?(n.scale(1,-1),n.image(t,m,-d,p,-u)):this.instance?(this.instance.scale(1,-1),this.instance.image(t,m,-d,p,-u)):(scale(1,-1),image(t,m,-d,p,-u)):e?(n.scale(-1,-1),n.image(t,-m,-d,-p,-u)):this.instance?(this.instance.scale(-1,-1),this.instance.image(t,-m,-d,-p,-u)):(scale(-1,-1),image(t,-m,-d,-p,-u)),e?n.pop():this.instance?this.instance.pop():pop()):e?n.image(t,m,d,p,u):this.instance?this.instance.image(t,m,d,p,u):image(t,m,d,p,u),m+=p,m>=a){g=!0,m=this.#n.tX_anchor,d+=u;break}g=!g}x=!x}n?n.blendMode(this.instance?this.instance.BLEND:BLEND):this.instance?this.instance.blendMode(this.instance.BLEND):blendMode(BLEND),e&&n.reset()}#e(t,i){return t=Math.ceil(t),i=Math.floor(i),Math.floor(this.#t()*(i-t+1)+t)}}const p5grain=new P5Grain;p5.prototype.granulateSimple=function(t,i){return p5grain.granulateSimple(t,i)},p5.Graphics.prototype.granulateSimple=function(t,i){return p5grain.granulateSimple(t,i,this)},p5.prototype.granulateChannels=function(t,i){return p5grain.granulateChannels(t,i)},p5.Graphics.prototype.granulateChannels=function(t,i){return p5grain.granulateChannels(t,i,this)},p5.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i)},p5.Graphics.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i,this)},p5.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i)},p5.Graphics.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i,this)},p5.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i)},p5.Graphics.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i,this)},p5.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i)},p5.Graphics.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i,this)},p5.prototype.textureAnimate=function(t,i){return p5grain.textureAnimate(t,i)},p5.prototype.textureOverlay=function(t,i){return p5grain.textureOverlay(t,i)},p5.Graphics.prototype.textureOverlay=function(t,i){return p5grain.textureOverlay(t,i,this)};
