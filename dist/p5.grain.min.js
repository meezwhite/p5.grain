/**!
 * p5.grain
 * 
 * @version 0.6.1
 * @license MIT
 * @copyright meezwhite, Gorilla Sun
 */
class P5Grain{version="0.6.1";instance;ignoreWarnings=!1;ignoreErrors=!1;#e;#t;#n;constructor(){this.#e=Math.random,this.#t={frameCount:0},this.#n={frameCount:0,tX_anchor:0,tX:0,tY:0}}setup(e){this.#i("setup",arguments),void 0===e?this.#e=random:"object"==typeof e&&("function"==typeof e.random&&(this.#e=e.random),"object"==typeof e.instance&&(this.instance=e.instance),"boolean"==typeof e.ignoreWarnings&&(this.ignoreWarnings=e.ignoreWarnings),"boolean"==typeof e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors))}granulateSimple(e,t,n){this.#i("granulateSimple",arguments);const i=this.instance?this.instance.round(e):round(e),a=t||!1;n?n.loadPixels():this.instance?this.instance.loadPixels():loadPixels();const r=n?n.pixelDensity():this.instance?this.instance.pixelDensity():pixelDensity(),s=(n?n.width:this.instance?this.instance.width:width)*r*4*((n?n.height:this.instance?this.instance.height:height)*r),o=n?n.pixels:this.instance?this.instance.pixels:pixels;for(let e=0;e<s;e+=4){const t=this.#a(-i,i);o[e]=o[e]+t,o[e+1]=o[e+1]+t,o[e+2]=o[e+2]+t,a&&(o[e+3]=o[e+3]+t)}n?n.updatePixels():this.instance?this.instance.updatePixels():updatePixels()}granulateChannels(e,t,n){this.#i("granulateChannels",arguments);const i=this.instance?this.instance.round(e):round(e),a=t||!1;n?n.loadPixels():this.instance?this.instance.loadPixels():loadPixels();const r=n?n.pixelDensity():this.instance?this.instance.pixelDensity():pixelDensity(),s=(n?n.width:this.instance?this.instance.width:width)*r*4*((n?n.height:this.instance?this.instance.height:height)*r),o=n?n.pixels:this.instance?this.instance.pixels:pixels;for(let e=0;e<s;e+=4)o[e]=o[e]+this.#a(-i,i),o[e+1]=o[e+1]+this.#a(-i,i),o[e+2]=o[e+2]+this.#a(-i,i),a&&(o[e+3]=o[e+3]+this.#a(-i,i));n?n.updatePixels():this.instance?this.instance.updatePixels():updatePixels()}tinkerPixels(e,t,n){this.#i("tinkerPixels",arguments),t=!1!==t,n?n.loadPixels():this.instance?this.instance.loadPixels():loadPixels();const i=n?n.pixelDensity():this.instance?this.instance.pixelDensity():pixelDensity(),a=(n?n.width:this.instance?this.instance.width:width)*i*4*((n?n.height:this.instance?this.instance.height:height)*i);for(let t=0;t<a;t+=4)e(t,a);t&&(n?n.updatePixels():this.instance?this.instance.updatePixels():updatePixels())}textureAnimate(e,t){this.#i("textureAnimate",arguments);const n=t&&t.atFrame?this.instance?this.instance.round(t.atFrame):round(t.atFrame):2;if(this.#t.frameCount+=1,this.#t.frameCount>=n){const n=t&&t.amount?this.instance?this.instance.round(t.amount):round(t.amount):this.instance?this.instance.min(this.instance.width,this.instance.height):min(width,height),i=this.#e()*n,a=this.#e()*n,r=this.instance?this.instance.floor(i):floor(i),s=this.instance?this.instance.floor(a):floor(a),o=`${r}px ${s}px`;e instanceof HTMLElement?e.style.backgroundPosition=o:e instanceof SVGElement?(e.style.top=-s+"px",e.style.left=-r+"px"):e instanceof p5.Element&&e.style("background-position",o),this.#t.frameCount=0}}textureOverlay(e,t,n){this.#i("textureOverlay",arguments);const i=n instanceof p5.Graphics,a=i?n.width:this.instance?this.instance.width:width,r=i?n.height:this.instance?this.instance.height:height,s=t&&t.mode?t.mode:this.instance?this.instance.MULTIPLY:MULTIPLY,o=!(!t||!t.reflect)&&t.reflect,p=!(!t||!t.animate)&&t.animate,h=t&&t.animate&&t.animate.atFrame?this.instance?this.instance.round(t.animate.atFrame):round(t.animate.atFrame):2,c=t&&t.animate&&t.animate.amount?this.instance?this.instance.round(t.animate.amount):round(t.animate.amount):this.instance?this.instance.min(a,r):min(a,r),l=t&&"number"==typeof t.width?t.width:e.width,g=t&&"number"==typeof t.height?t.height:e.height;if(p&&(this.#n.frameCount+=1,this.#n.frameCount>=h)){const e=this.#e()*c,t=this.#e()*c;this.#n.tX_anchor=this.instance?-this.instance.floor(e):-floor(e),this.#n.tY=this.instance?-this.instance.floor(t):-floor(t),this.#n.frameCount=0}let u=this.#n.tX_anchor,d=this.#n.tY,m=!0,f=!0;for(n?n.blendMode(s):this.instance?this.instance.blendMode(s):blendMode(s);d<r;){for(;u<a;){if(o?(i?n.push():this.instance?this.instance.push():push(),m?f?i?n.image(e,u,d,l,g):this.instance?this.instance.image(e,u,d,l,g):image(e,u,d,l,g):i?(n.scale(-1,1),n.image(e,-u,d,-l,g)):this.instance?(this.instance.scale(-1,1),this.instance.image(e,-u,d,-l,g)):(scale(-1,1),image(e,-u,d,-l,g)):f?i?(n.scale(1,-1),n.image(e,u,-d,l,-g)):this.instance?(this.instance.scale(1,-1),this.instance.image(e,u,-d,l,-g)):(scale(1,-1),image(e,u,-d,l,-g)):i?(n.scale(-1,-1),n.image(e,-u,-d,-l,-g)):this.instance?(this.instance.scale(-1,-1),this.instance.image(e,-u,-d,-l,-g)):(scale(-1,-1),image(e,-u,-d,-l,-g)),i?n.pop():this.instance?this.instance.pop():pop()):i?n.image(e,u,d,l,g):this.instance?this.instance.image(e,u,d,l,g):image(e,u,d,l,g),u+=l,u>=a){f=!0,u=this.#n.tX_anchor,d+=g;break}f=!f}m=!m}n?n.blendMode(this.instance?this.instance.BLEND:BLEND):this.instance?this.instance.blendMode(this.instance.BLEND):blendMode(BLEND),i&&n.reset()}#a(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(this.#e()*(t-e+1)+e)}#i(e,t){if(!this.ignoreErrors)switch(e){case"setup":if(void 0!==t[0]&&"object"!=typeof t[0])throw new Error(`[p5.grain] The optional config argument passed to p5grain.${e}() must be of type object.`);if("object"==typeof t[0]){if(void 0!==t[0].random&&"function"!=typeof t[0].random)throw new Error(`[p5.grain] The optional config.random property passed to p5grain.${e}() must be of type function.`);if(void 0!==t[0].ignoreErrors&&"boolean"!=typeof t[0].ignoreErrors)throw new Error(`[p5.grain] The optional config.ignoreErrors property passed to p5grain.${e}() must be of type boolean.`);if(void 0!==t[0].ignoreWarnings&&"boolean"!=typeof t[0].ignoreWarnings)throw new Error(`[p5.grain] The optional config.ignoreWarnings property passed to p5grain.${e}() must be of type boolean.`);if(void 0!==t[0].instance&&"object"!=typeof t[0].instance)throw new Error(`[p5.grain] The optional config.instance property passed to p5grain.${e}() must be of type object.`)}break;case"granulateSimple":case"granulateChannels":if("number"!=typeof t[0])throw new Error(`[p5.grain] The amount argument passed to ${e}() must be of type number.`);if(void 0!==t[1]&&"boolean"!=typeof t[1])throw new Error(`[p5.grain] The optional alpha argument passed to ${e}() must be of type boolean.`);if(void 0!==t[2]&&!(t[2]instanceof p5.Graphics))throw new Error(`[p5.grain] The offscreen graphics buffer for ${e}() must be an instance of p5.Graphics.`);break;case"tinkerPixels":if("function"!=typeof t[0])throw new Error(`[p5.grain] The callback argument passed to ${e}() must be of type function.`);if(void 0!==t[1]&&"boolean"!=typeof t[1])throw new Error(`[p5.grain] The optional shouldUpdate argument for ${e}() must be an instance of boolean.`);if(void 0!==t[2]&&!(t[2]instanceof p5.Graphics))throw new Error(`[p5.grain] The offscreen graphics buffer for ${e}() must be an instance of p5.Graphics.`);break;case"textureAnimate":if(!(t[0]instanceof HTMLElement||t[0]instanceof SVGElement||t[0]instanceof p5.Element))throw new Error(`[p5.grain] The textureElement argument passed to ${e}() must be an instance of HTMLElement, SVGElement or p5.Element.`);if(void 0!==t[1]&&"object"!=typeof t[1])throw new Error(`[p5.grain] The optional config argument passed to ${e}() must be of type object.`);if("object"==typeof t[1]){if(void 0!==t[1].atFrame&&"number"!=typeof t[1].atFrame)throw new Error(`[p5.grain] The optional config.atFrame property passed to ${e}() must be of type number.`);if(void 0!==t[1].amount&&"number"!=typeof t[1].amount)throw new Error(`[p5.grain] The optional config.amount argument passed to ${e}() must be of type number.`)}break;case"textureOverlay":if(!(t[0]instanceof p5.Image))throw new Error(`[p5.grain] The texture argument passed to ${e}() must be an instance of p5.Image.`);if(void 0!==t[1]&&"object"!=typeof t[1])throw new Error(`[p5.grain] The optional config argument passed to ${e}() must be of type object.`);if("object"==typeof t[1]){if(void 0!==t[1].width&&"number"!=typeof t[1].width)throw new Error(`[p5.grain] The optional config.width property passed to ${e}() must be of type number.`);if(void 0!==t[1].height&&"number"!=typeof t[1].height)throw new Error(`[p5.grain] The optional config.height property passed to ${e}() must be of type number.`);if(void 0!==t[1].mode&&"string"!=typeof t[1].mode)throw new Error(`[p5.grain] The optional config.mode property passed to ${e}() must be of type string.`);if(void 0!==t[1].reflect&&"boolean"!=typeof t[1].reflect)throw new Error(`[p5.grain] The optional config.reflect property passed to ${e}() must be of type boolean.`)}if(void 0!==t[2]&&!(t[2]instanceof p5.Graphics))throw new Error(`[p5.grain] The offscreen graphics buffer for ${e}() must be an instance of p5.Graphics.`)}}}const p5grain=new P5Grain;p5.prototype.hasOwnProperty("granulateSimple")?p5grain.ignoreWarnings||console.warn("[p5.grain] granulateSimple() could not be registered, since it's already defined.\nUse p5grain.granulateSimple() instead."):p5.prototype.granulateSimple=function(e,t){return p5grain.granulateSimple(e,t)},p5.Graphics.prototype.hasOwnProperty("granulateSimple")?p5grain.ignoreWarnings||console.warn("[p5.grain] p5.Graphics.granulateSimple() could not be registered, since it's already defined.\nUse p5grain.granulateSimple(amount, alpha, pg) instead."):p5.Graphics.prototype.granulateSimple=function(e,t){return p5grain.granulateSimple(e,t,this)},p5.prototype.hasOwnProperty("granulateChannels")?p5grain.ignoreWarnings||console.warn("[p5.grain] granulateChannels() could not be registered, since it's already defined.\nUse p5grain.granulateChannels() instead."):p5.prototype.granulateChannels=function(e,t){return p5grain.granulateChannels(e,t)},p5.Graphics.prototype.hasOwnProperty("granulateChannels")?p5grain.ignoreWarnings||console.warn("[p5.grain] p5.Graphics.granulateChannels() could not be registered, since it's already defined.\nUse p5grain.granulateChannels(amount, alpha, pg) instead."):p5.Graphics.prototype.granulateChannels=function(e,t){return p5grain.granulateChannels(e,t,this)},p5.prototype.hasOwnProperty("tinkerPixels")?p5grain.ignoreWarnings||console.warn("[p5.grain] tinkerPixels() could not be registered, since it's already defined.\nUse p5grain.tinkerPixels() instead."):p5.prototype.tinkerPixels=function(e,t){return p5grain.tinkerPixels(e,t)},p5.Graphics.prototype.hasOwnProperty("tinkerPixels")?p5grain.ignoreWarnings||console.warn("[p5.grain] p5.Graphics.tinkerPixels() could not be registered, since it's already defined.\nUse p5grain.tinkerPixels(callback, shouldUpdate, pg) instead."):p5.Graphics.prototype.tinkerPixels=function(e,t){return p5grain.tinkerPixels(e,t,this)},p5.prototype.hasOwnProperty("textureAnimate")?p5grain.ignoreWarnings||console.warn("[p5.grain] textureAnimate() could not be registered, since it's already defined.\nUse p5grain.textureAnimate() instead."):p5.prototype.textureAnimate=function(e,t){return p5grain.textureAnimate(e,t)},p5.prototype.hasOwnProperty("textureOverlay")?p5grain.ignoreWarnings||console.warn("[p5.grain] textureOverlay() could not be registered, since it's already defined.\nUse p5grain.textureOverlay() instead."):p5.prototype.textureOverlay=function(e,t){return p5grain.textureOverlay(e,t)},p5.Graphics.prototype.hasOwnProperty("textureOverlay")?p5grain.ignoreWarnings||console.warn("[p5.grain] p5.Graphics.textureOverlay() could not be registered, since it's already defined.\nUse p5grain.textureOverlay(textureImage, config, pg) instead."):p5.Graphics.prototype.textureOverlay=function(e,t){return p5grain.textureOverlay(e,t,this)};
