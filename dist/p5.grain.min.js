/**!
 * p5.grain
 * 
 * @version 0.6.1
 * @license MIT
 * @copyright meezwhite, Gorilla Sun
 */
class P5Grain{version="0.6.1";ignoreWarnings=!1;ignoreErrors=!1;#e;#t;#n;instanceMode=!1;instanceRef;constructor(){this.#e=Math.random,this.#t={frameCount:0},this.#n={frameCount:0,tX_anchor:0,tX:0,tY:0}}setup(e){this.#i("setup",arguments),void 0===e?this.#e=random:"object"==typeof e&&("function"==typeof e.random&&(this.#e=e.random),"boolean"==typeof e.instanceMode&&(this.instanceMode=e.instanceMode),"object"==typeof e.instanceRef&&(this.instanceRef=e.instanceRef,this.instanceRef.p5grain=this),"boolean"==typeof e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),"boolean"==typeof e.ignoreWarnings&&(this.ignoreWarnings=e.ignoreWarnings))}granulateSimple(e,t,n){this.#i("granulateSimple",arguments);const i=this.instanceMode?this.instanceRef.round(e):round(e),o=t||!1;n?n.loadPixels():this.instanceMode?this.instanceRef.loadPixels():loadPixels();const s=n?n.pixelDensity():this.instanceMode?this.instanceRef.pixelDensity():pixelDensity(),a=(this.instanceMode?this.instanceRef.width:width)*s*4*((this.instanceMode?this.instanceRef.height:height)*s),r=n?n.pixels:this.instanceMode?this.instanceRef.pixels:pixels;for(let e=0;e<a;e+=4){const t=this.#o(-i,i);r[e]=r[e]+t,r[e+1]=r[e+1]+t,r[e+2]=r[e+2]+t,o&&(r[e+3]=r[e+3]+t)}n?n.updatePixels():this.instanceMode?this.instanceRef.updatePixels():updatePixels()}granulateChannels(e,t,n){this.#i("granulateChannels",arguments);const i=round(e),o=t||!1;n?n.loadPixels():this.instanceMode?this.instanceRef.loadPixels():loadPixels();const s=n?n.pixelDensity():this.instanceMode?this.instanceRef.pixelDensity():pixelDensity(),a=(this.instanceMode?this.instanceRef.width:width)*s*4*((this.instanceMode?this.instanceRef.height:height)*s),r=n?n.pixels:this.instanceMode?this.instanceRef.pixels:pixels;for(let e=0;e<a;e+=4)r[e]=r[e]+this.#o(-i,i),r[e+1]=r[e+1]+this.#o(-i,i),r[e+2]=r[e+2]+this.#o(-i,i),o&&(r[e+3]=r[e+3]+this.#o(-i,i));n?n.updatePixels():this.instanceMode?this.instanceRef.updatePixels():updatePixels()}tinkerPixels(e,t,n){this.#i("tinkerPixels",arguments),t=!1!==t,n?n.loadPixels():this.instanceMode?this.instanceRef.loadPixels():loadPixels();const i=n?n.pixelDensity():this.instanceMode?this.instanceRef.pixelDensity():pixelDensity(),o=(this.instanceMode?this.instanceRef.width:width)*i*4*((this.instanceMode?this.instanceRef.height:height)*i);for(let t=0;t<o;t+=4)e(t,o);t&&(n?n.updatePixels():this.instanceMode?this.instanceRef.updatePixels():updatePixels())}textureAnimate(e,t){this.#i("textureAnimate",arguments);const n=t&&t.atFrame?this.instanceMode?this.instanceRef.round(t.atFrame):round(t.atFrame):2;if(this.#t.frameCount+=1,this.#t.frameCount>=n){const n=t&&t.amount?this.instanceMode?this.instanceRef.round(t.amount):round(t.amount):this.instanceMode?this.instanceRef.min(this.instanceMode?this.instanceRef.width:width,this.instanceMode?this.instanceRef.height:height):min(width,height),i=this.instanceMode?this.instanceRef.floor(this.#e()*n):floor(this.#e()*n),o=this.instanceMode?this.instanceRef.floor(this.#e()*n):floor(this.#e()*n),s=`${i}px ${o}px`;e instanceof HTMLElement?e.style.backgroundPosition=s:e instanceof SVGElement?(e.style.top=-o+"px",e.style.left=-i+"px"):e instanceof p5.Element&&e.style("background-position",s),this.#t.frameCount=0}}textureOverlay(e,t,n){this.#i("textureOverlay",arguments);const i=n instanceof p5.Graphics,o=i?n.width:this.instanceMode?this.instanceRef.width:width,s=i?n.height:height,a=t&&t.mode?t.mode:this.instanceMode?this.instanceRef.MULTIPLY:MULTIPLY,r=!(!t||!t.reflect)&&t.reflect,h=!(!t||!t.animate)&&t.animate,c=t&&t.animate&&t.animate.atFrame?round(t.animate.atFrame):2,f=t&&t.animate&&t.animate.amount?this.instanceMode?this.instanceRef.round(t.animate.amount):round(t.animate.amount):this.instanceMode?this.instanceRef.min(o,s):min(o,s),p=t&&"number"==typeof t.width?t.width:e.width,d=t&&"number"==typeof t.height?t.height:e.height;h&&(this.#n.frameCount+=1,this.#n.frameCount>=c&&(this.#n.tX_anchor=this.instanceMode?-this.instanceRef.floor(this.#e()*f):-floor(this.#e()*f),this.#n.tY=this.instanceMode?-this.instanceRef.floor(this.#e()*f):-floor(this.#e()*f),this.#n.frameCount=0));let l=this.#n.tX_anchor,m=this.#n.tY,u=!0,g=!0;for(n?n.blendMode(a):this.instanceMode?this.instanceRef.blendMode(a):blendMode(a);m<s;){for(;l<o;){if(r?(i?n.push():this.instanceMode?this.instanceRef.push():push(),u?g?i?n.image(e,l,m,p,d):this.instanceMode?this.instanceRef.image(e,l,m,p,d):image(e,l,m,p,d):i?(n.scale(-1,1),n.image(e,-l,m,-p,d)):(this.instanceMode?this.instanceRef.scale(-1,1):scale(-1,1),this.instanceMode?this.instanceRef.image(e,-l,m,-p,d):image(e,-l,m,-p,d)):g?i?(n.scale(1,-1),n.image(e,l,-m,p,-d)):(this.instanceMode?this.instanceRef.scale(1,-1):scale(1,-1),this.instanceMode?this.instanceRef.image(e,l,-m,p,-d):image(e,l,-m,p,-d)):i?(n.scale(-1,-1),n.image(e,-l,-m,-p,-d)):(this.instanceMode?this.instanceRef.scale(-1,-1):scale(-1,-1),this.instanceMode?this.instanceRef.image(e,-l,-m,-p,-d):image(e,-l,-m,-p,-d)),i?n.pop():this.instanceMode?this.instanceRef.pop():pop()):i?n.image(e,l,m,p,d):this.instanceMode?this.instanceRef.image(e,l,m,p,d):image(e,l,m,p,d),l+=p,l>=o){g=!0,l=this.#n.tX_anchor,m+=d;break}g=!g}u=!u}n?n.blendMode(this.instanceMode?this.instanceRef.BLEND:BLEND):this.instanceMode?this.instanceRef.blendMode(this.instanceRef.BLEND):blendMode(BLEND),i&&n.reset()}#o(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(this.#e()*(t-e+1)+e)}#i(e,t){if(!this.ignoreErrors)switch(e){case"setup":if(void 0!==t[0]&&"object"!=typeof t[0])throw new Error(`[p5.grain] The optional config argument passed to p5grain.${e}() must be of type object.`);if("object"==typeof t[0]){if(void 0!==t[0].random&&"function"!=typeof t[0].random)throw new Error(`[p5.grain] The optional config.random property passed to p5grain.${e}() must be of type function.`);if(void 0!==t[0].ignoreErrors&&"boolean"!=typeof t[0].ignoreErrors)throw new Error(`[p5.grain] The optional config.ignoreErrors property passed to p5grain.${e}() must be of type boolean.`);if(void 0!==t[0].ignoreWarnings&&"boolean"!=typeof t[0].ignoreWarnings)throw new Error(`[p5.grain] The optional config.ignoreWarnings property passed to p5grain.${e}() must be of type boolean.`);if(void 0!==t[0].instanceMode&&"boolean"!=typeof t[0].instanceMode)throw new Error(`[p5.grain] The optional config.instanceMode property passed to p5grain.${e}() must be of type boolean.`);if(void 0!==t[0].instanceRef&&"object"!=typeof t[0].instanceRef)throw new Error(`[p5.grain] The optional config.instanceRef property passed to p5grain.${e}() must be of type object.`);if(void 0!==t[0].instanceMode&&void 0===t[0].instanceRef||void 0!==t[0].instanceRef&&void 0===t[0].instanceMode)throw new Error(`[p5.grain] The optional config.instanceRef property passed to p5grain.${e}() must be given with config.instanceMode.`)}break;case"granulateSimple":case"granulateChannels":if("number"!=typeof t[0])throw new Error(`[p5.grain] The amount argument passed to ${e}() must be of type number.`);if(void 0!==t[1]&&"boolean"!=typeof t[1])throw new Error(`[p5.grain] The optional alpha argument passed to ${e}() must be of type boolean.`);if(void 0!==t[2]&&!(t[2]instanceof p5.Graphics))throw new Error(`[p5.grain] The offscreen graphics buffer for ${e}() must be an instance of p5.Graphics.`);break;case"tinkerPixels":if("function"!=typeof t[0])throw new Error(`[p5.grain] The callback argument passed to ${e}() must be of type function.`);if(void 0!==t[1]&&"boolean"!=typeof t[1])throw new Error(`[p5.grain] The optional shouldUpdate argument for ${e}() must be an instance of boolean.`);if(void 0!==t[2]&&!(t[2]instanceof p5.Graphics))throw new Error(`[p5.grain] The offscreen graphics buffer for ${e}() must be an instance of p5.Graphics.`);break;case"textureAnimate":if(!(t[0]instanceof HTMLElement||t[0]instanceof SVGElement||t[0]instanceof p5.Element))throw new Error(`[p5.grain] The textureElement argument passed to ${e}() must be an instance of HTMLElement, SVGElement or p5.Element.`);if(void 0!==t[1]&&"object"!=typeof t[1])throw new Error(`[p5.grain] The optional config argument passed to ${e}() must be of type object.`);if("object"==typeof t[1]){if(void 0!==t[1].atFrame&&"number"!=typeof t[1].atFrame)throw new Error(`[p5.grain] The optional config.atFrame property passed to ${e}() must be of type number.`);if(void 0!==t[1].amount&&"number"!=typeof t[1].amount)throw new Error(`[p5.grain] The optional config.amount argument passed to ${e}() must be of type number.`)}break;case"textureOverlay":if(!(t[0]instanceof p5.Image))throw new Error(`[p5.grain] The texture argument passed to ${e}() must be an instance of p5.Image.`);if(void 0!==t[1]&&"object"!=typeof t[1])throw new Error(`[p5.grain] The optional config argument passed to ${e}() must be of type object.`);if("object"==typeof t[1]){if(void 0!==t[1].width&&"number"!=typeof t[1].width)throw new Error(`[p5.grain] The optional config.width property passed to ${e}() must be of type number.`);if(void 0!==t[1].height&&"number"!=typeof t[1].height)throw new Error(`[p5.grain] The optional config.height property passed to ${e}() must be of type number.`);if(void 0!==t[1].mode&&"string"!=typeof t[1].mode)throw new Error(`[p5.grain] The optional config.mode property passed to ${e}() must be of type string.`);if(void 0!==t[1].reflect&&"boolean"!=typeof t[1].reflect)throw new Error(`[p5.grain] The optional config.reflect property passed to ${e}() must be of type boolean.`)}if(void 0!==t[2]&&!(t[2]instanceof p5.Graphics))throw new Error(`[p5.grain] The offscreen graphics buffer for ${e}() must be an instance of p5.Graphics.`)}}}
