/**!
 * p5.grain
 * 
 * @version 0.6.0
 * @license MIT
 * @copyright meezwhite, Gorilla Sun
 */
class P5Grain{version="0.6.0";ignoreWarnings=!1;ignoreErrors=!1;#e;#t;#r;constructor(){this.#e=Math.random,this.#t={frameCount:0},this.#r={frameCount:0,tX_anchor:0,tX:0,tY:0}}setup(e){this.#n("setup",arguments),void 0===e?this.#e=random:"object"==typeof e&&("function"==typeof e.random&&(this.#e=e.random),"boolean"==typeof e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),"boolean"==typeof e.ignoreWarnings&&(this.ignoreWarnings=e.ignoreWarnings))}granulateSimple(e,t,r){this.#n("granulateSimple",arguments);const n=round(e),a=t||!1;r?r.loadPixels():loadPixels();const i=r?r.pixelDensity():pixelDensity(),o=width*i*4*(height*i),s=r?r.pixels:pixels;for(let e=0;e<o;e+=4){const t=this.#a(-n,n);s[e]=s[e]+t,s[e+1]=s[e+1]+t,s[e+2]=s[e+2]+t,a&&(s[e+3]=s[e+3]+t)}r?r.updatePixels():updatePixels()}granulateChannels(e,t,r){this.#n("granulateChannels",arguments);const n=round(e),a=t||!1;r?r.loadPixels():loadPixels();const i=r?r.pixelDensity():pixelDensity(),o=width*i*4*(height*i),s=r?r.pixels:pixels;for(let e=0;e<o;e+=4)s[e]=s[e]+this.#a(-n,n),s[e+1]=s[e+1]+this.#a(-n,n),s[e+2]=s[e+2]+this.#a(-n,n),a&&(s[e+3]=s[e+3]+this.#a(-n,n));r?r.updatePixels():updatePixels()}tinkerPixels(e,t,r){this.#n("tinkerPixels",arguments),t=!1!==t,r?r.loadPixels():loadPixels();const n=r?r.pixelDensity():pixelDensity(),a=width*n*4*(height*n);for(let t=0;t<a;t+=4)e(t,a);t&&(r?r.updatePixels():updatePixels())}textureAnimate(e,t){this.#n("textureAnimate",arguments);const r=t&&t.atFrame?round(t.atFrame):2;if(this.#t.frameCount+=1,this.#t.frameCount>=r){const r=t&&t.amount?round(t.amount):min(width,height),n=floor(this.#e()*r),a=floor(this.#e()*r),i=`${n}px ${a}px`;e instanceof HTMLElement?e.style.backgroundPosition=i:e instanceof SVGElement?(e.style.top=-a+"px",e.style.left=-n+"px"):e instanceof p5.Element&&e.style("background-position",i),this.#t.frameCount=0}}textureOverlay(e,t,r){this.#n("textureOverlay",arguments);const n=r instanceof p5.Graphics,a=n?r.width:width,i=n?r.height:height,o=t.mode||MULTIPLY,s=t.reflect||!1,p=t.animate||!1,l=t.animate&&t.animate.atFrame?round(t.animate.atFrame):2,g=t.animate&&t.animate.amount?round(t.animate.amount):min(a,i),u="number"==typeof t.width?t.width:e.width,h="number"==typeof t.height?t.height:e.height;p&&(this.#r.frameCount+=1,this.#r.frameCount>=l&&(this.#r.tX_anchor=-floor(this.#e()*g),this.#r.tY=-floor(this.#e()*g),this.#r.frameCount=0));let d=this.#r.tX_anchor,f=this.#r.tY,m=!0,c=!0;for(r?r.blendMode(o):blendMode(o);f<i;){for(;d<a;){if(s?(n?r.push():push(),m?c?n?r.image(e,d,f,u,h):image(e,d,f,u,h):n?(r.scale(-1,1),r.image(e,-d,f,-u,h)):(scale(-1,1),image(e,-d,f,-u,h)):c?n?(r.scale(1,-1),r.image(e,d,-f,u,-h)):(scale(1,-1),image(e,d,-f,u,-h)):n?(r.scale(-1,-1),r.image(e,-d,-f,-u,-h)):(scale(-1,-1),image(e,-d,-f,-u,-h)),n?r.pop():pop()):n?r.image(e,d,f,u,h):image(e,d,f,u,h),d+=u,d>=a){c=!0,d=this.#r.tX_anchor,f+=h;break}c=!c}m=!m}r?r.blendMode(BLEND):blendMode(BLEND),n&&r.reset()}#a(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(this.#e()*(t-e+1)+e)}#n(e,t){if(!this.ignoreErrors)switch(e){case"setup":if(void 0!==t[0]&&"object"!=typeof t[0])throw new Error(`[p5.grain] The optional config argument passed to p5grain.${e}() must be of type object.`);if("object"==typeof t[0]){if(void 0!==t[0].random&&"function"!=typeof t[0].random)throw new Error(`[p5.grain] The optional config.random property passed to p5grain.${e}() must be of type function.`);if(void 0!==t[0].ignoreErrors&&"boolean"!=typeof t[0].ignoreErrors)throw new Error(`[p5.grain] The optional config.ignoreErrors property passed to p5grain.${e}() must be of type boolean.`);if(void 0!==t[0].ignoreWarnings&&"boolean"!=typeof t[0].ignoreWarnings)throw new Error(`[p5.grain] The optional config.ignoreWarnings property passed to p5grain.${e}() must be of type boolean.`)}break;case"granulateSimple":case"granulateChannels":if("number"!=typeof t[0])throw new Error(`[p5.grain] The amount argument passed to ${e}() must be of type number.`);if(void 0!==t[1]&&"boolean"!=typeof t[1])throw new Error(`[p5.grain] The optional alpha argument passed to ${e}() must be of type boolean.`);if(void 0!==t[2]&&!(t[2]instanceof p5.Graphics))throw new Error(`[p5.grain] The offscreen graphics buffer for ${e}() must be an instance of p5.Graphics.`);break;case"tinkerPixels":if("function"!=typeof t[0])throw new Error(`[p5.grain] The callback argument passed to ${e}() must be of type function.`);if(void 0!==t[1]&&"boolean"!=typeof t[1])throw new Error(`[p5.grain] The optional shouldUpdate argument for ${e}() must be an instance of boolean.`);if(void 0!==t[2]&&!(t[2]instanceof p5.Graphics))throw new Error(`[p5.grain] The offscreen graphics buffer for ${e}() must be an instance of p5.Graphics.`);break;case"textureAnimate":if(!(t[0]instanceof HTMLElement||t[0]instanceof SVGElement||t[0]instanceof p5.Element))throw new Error(`[p5.grain] The textureElement argument passed to ${e}() must be an instance of HTMLElement, SVGElement or p5.Element.`);if(void 0!==t[1]&&"object"!=typeof t[1])throw new Error(`[p5.grain] The optional config argument passed to ${e}() must be of type object.`);if("object"==typeof t[1]){if(void 0!==t[1].atFrame&&"number"!=typeof t[1].atFrame)throw new Error(`[p5.grain] The optional config.atFrame property passed to ${e}() must be of type number.`);if(void 0!==t[1].amount&&"number"!=typeof t[1].amount)throw new Error(`[p5.grain] The optional config.amount argument passed to ${e}() must be of type number.`)}break;case"textureOverlay":if(!(t[0]instanceof p5.Image))throw new Error(`[p5.grain] The texture argument passed to ${e}() must be an instance of p5.Image.`);if(void 0!==t[1]&&"object"!=typeof t[1])throw new Error(`[p5.grain] The optional config argument passed to ${e}() must be of type object.`);if("object"==typeof t[1]){if(void 0!==t[1].width&&"number"!=typeof t[1].width)throw new Error(`[p5.grain] The optional config.width property passed to ${e}() must be of type number.`);if(void 0!==t[1].height&&"number"!=typeof t[1].height)throw new Error(`[p5.grain] The optional config.height property passed to ${e}() must be of type number.`);if(void 0!==t[1].mode&&"string"!=typeof t[1].mode)throw new Error(`[p5.grain] The optional config.mode property passed to ${e}() must be of type string.`);if(void 0!==t[1].reflect&&"boolean"!=typeof t[1].reflect)throw new Error(`[p5.grain] The optional config.reflect property passed to ${e}() must be of type boolean.`)}if(void 0!==t[2]&&!(t[2]instanceof p5.Graphics))throw new Error(`[p5.grain] The offscreen graphics buffer for ${e}() must be an instance of p5.Graphics.`)}}}const p5grain=new P5Grain;p5.prototype.hasOwnProperty("granulateSimple")?p5grain.ignoreWarnings||console.warn("[p5.grain] granulateSimple() could not be registered, since it's already defined.\nUse p5grain.granulateSimple() instead."):p5.prototype.granulateSimple=function(e,t){return p5grain.granulateSimple(e,t)},p5.Graphics.prototype.hasOwnProperty("granulateSimple")?p5grain.ignoreWarnings||console.warn("[p5.grain] p5.Graphics.granulateSimple() could not be registered, since it's already defined.\nUse p5grain.granulateSimple(amount, alpha, pg) instead."):p5.Graphics.prototype.granulateSimple=function(e,t){return p5grain.granulateSimple(e,t,this)},p5.prototype.hasOwnProperty("granulateChannels")?p5grain.ignoreWarnings||console.warn("[p5.grain] granulateChannels() could not be registered, since it's already defined.\nUse p5grain.granulateChannels() instead."):p5.prototype.granulateChannels=function(e,t){return p5grain.granulateChannels(e,t)},p5.Graphics.prototype.hasOwnProperty("granulateChannels")?p5grain.ignoreWarnings||console.warn("[p5.grain] p5.Graphics.granulateChannels() could not be registered, since it's already defined.\nUse p5grain.granulateChannels(amount, alpha, pg) instead."):p5.Graphics.prototype.granulateChannels=function(e,t){return p5grain.granulateChannels(e,t,this)},p5.prototype.hasOwnProperty("tinkerPixels")?p5grain.ignoreWarnings||console.warn("[p5.grain] tinkerPixels() could not be registered, since it's already defined.\nUse p5grain.tinkerPixels() instead."):p5.prototype.tinkerPixels=function(e,t){return p5grain.tinkerPixels(e,t)},p5.Graphics.prototype.hasOwnProperty("tinkerPixels")?p5grain.ignoreWarnings||console.warn("[p5.grain] p5.Graphics.tinkerPixels() could not be registered, since it's already defined.\nUse p5grain.tinkerPixels(callback, shouldUpdate, pg) instead."):p5.Graphics.prototype.tinkerPixels=function(e,t){return p5grain.tinkerPixels(e,t,this)},p5.prototype.hasOwnProperty("textureAnimate")?p5grain.ignoreWarnings||console.warn("[p5.grain] textureAnimate() could not be registered, since it's already defined.\nUse p5grain.textureAnimate() instead."):p5.prototype.textureAnimate=function(e,t){return p5grain.textureAnimate(e,t)},p5.prototype.hasOwnProperty("textureOverlay")?p5grain.ignoreWarnings||console.warn("[p5.grain] textureOverlay() could not be registered, since it's already defined.\nUse p5grain.textureOverlay() instead."):p5.prototype.textureOverlay=function(e,t){return p5grain.textureOverlay(e,t)},p5.Graphics.prototype.hasOwnProperty("textureOverlay")?p5grain.ignoreWarnings||console.warn("[p5.grain] p5.Graphics.textureOverlay() could not be registered, since it's already defined.\nUse p5grain.textureOverlay(textureImage, config, pg) instead."):p5.Graphics.prototype.textureOverlay=function(e,t){return p5grain.textureOverlay(e,t,this)};
