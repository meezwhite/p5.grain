/**!
 * p5.grain
 * 
 * @version 0.8.0
 * @license MIT
 * @copyright meezwhite, Gorilla Sun
 */
class P5Grain{version="0.8.0";instance;#t;#i;#e;#n;#a;constructor(){this.#s("float"),this.#n={frameCount:0},this.#a={frameCount:0,tX_anchor:0,tX:0,tY:0}}setup(t){"object"==typeof t&&("function"==typeof t.random&&(this.#t=t.random),"string"==typeof t.randomMode&&this.#s(t.randomMode),"object"==typeof t.instance&&(this.instance=t.instance)),void 0===this.#t&&(this.#t=p5.prototype.random)}applyMonochromaticGrain(t,i,e){const n=i||!1;let a,s,r,o;e?(e.loadPixels(),a=e.pixelDensity(),s=e.width,r=e.height,o=e.pixels):this.instance?(this.instance.loadPixels(),a=this.instance.pixelDensity(),s=this.instance.width,r=this.instance.height,o=this.instance.pixels):(loadPixels(),a=pixelDensity(),s=width,r=height,o=pixels);const h=s*a*4*(r*a),{min:p,max:c}=this.#r(-t,t);for(let t=0;t<h;t+=4){const i=this.#i(p,c);o[t]=o[t]+i,o[t+1]=o[t+1]+i,o[t+2]=o[t+2]+i,n&&(o[t+3]=o[t+3]+i)}e?e.updatePixels():this.instance?this.instance.updatePixels():updatePixels()}applyChromaticGrain(t,i,e){const n=i||!1;let a,s,r,o;e?(e.loadPixels(),a=e.pixelDensity(),s=e.width,r=e.height,o=e.pixels):this.instance?(this.instance.loadPixels(),a=this.instance.pixelDensity(),s=this.instance.width,r=this.instance.height,o=this.instance.pixels):(loadPixels(),a=pixelDensity(),s=width,r=height,o=pixels);const h=s*a*4*(r*a),{min:p,max:c}=this.#r(-t,t);for(let t=0;t<h;t+=4)o[t]=o[t]+this.#i(p,c),o[t+1]=o[t+1]+this.#i(p,c),o[t+2]=o[t+2]+this.#i(p,c),n&&(o[t+3]=o[t+3]+this.#i(p,c));e?e.updatePixels():this.instance?this.instance.updatePixels():updatePixels()}tinkerPixels(t,i,e){let n,a,s;i=!1!==i,e?(e.loadPixels(),n=e.pixelDensity(),a=e.width,s=e.height):this.instance?(this.instance.loadPixels(),n=this.instance.pixelDensity(),a=this.instance.width,s=this.instance.height):(loadPixels(),n=pixelDensity(),a=width,s=height);const r=a*n*4*(s*n);for(let i=0;i<r;i+=4)t(i,r);i&&(e?e.updatePixels():this.instance?this.instance.updatePixels():updatePixels())}loopPixels(t,i){this.tinkerPixels(t,!1,i)}textureAnimate(t,i){const e=i&&i.atFrame?Math.round(i.atFrame):2;if(this.#n.frameCount+=1,this.#n.frameCount>=e){const e=i&&i.amount?Math.round(i.amount):this.instance?Math.min(this.instance.width,this.instance.height):Math.min(width,height),n=this.#t()*e,a=this.#t()*e,s=Math.floor(n),r=Math.floor(a),o=`${s}px ${r}px`;t instanceof HTMLElement?t.style.backgroundPosition=o:t instanceof SVGElement?(t.style.top=-r+"px",t.style.left=-s+"px"):t instanceof p5.Element&&t.style("background-position",o),this.#n.frameCount=0}}textureOverlay(t,i,e){const n=e instanceof p5.Graphics;let a,s;n?(a=e.width,s=e.height):this.instance?(a=this.instance.width,s=this.instance.height):(a=width,s=height);const r=i&&i.mode?i.mode:this.instance?this.instance.MULTIPLY:MULTIPLY,o=!(!i||!i.reflect)&&i.reflect,h=!(!i||!i.animate)&&i.animate,p=i&&i.animate&&i.animate.atFrame?Math.round(i.animate.atFrame):2,c=i&&i.animate&&i.animate.amount?Math.round(i.animate.amount):Math.min(a,s),l=i&&"number"==typeof i.width?i.width:t.width,m=i&&"number"==typeof i.height?i.height:t.height;if(h&&(this.#a.frameCount+=1,this.#a.frameCount>=p)){const t=this.#t()*c,i=this.#t()*c;this.#a.tX_anchor=-Math.floor(t),this.#a.tY=-Math.floor(i),this.#a.frameCount=0}let d=this.#a.tX_anchor,u=this.#a.tY,x=!0,y=!0;for(e?e.blendMode(r):this.instance?this.instance.blendMode(r):blendMode(r);u<s;){for(;d<a;){if(o?(n?e.push():this.instance?this.instance.push():push(),x?y?n?e.image(t,d,u,l,m):this.instance?this.instance.image(t,d,u,l,m):image(t,d,u,l,m):n?(e.scale(-1,1),e.image(t,-d,u,-l,m)):this.instance?(this.instance.scale(-1,1),this.instance.image(t,-d,u,-l,m)):(scale(-1,1),image(t,-d,u,-l,m)):y?n?(e.scale(1,-1),e.image(t,d,-u,l,-m)):this.instance?(this.instance.scale(1,-1),this.instance.image(t,d,-u,l,-m)):(scale(1,-1),image(t,d,-u,l,-m)):n?(e.scale(-1,-1),e.image(t,-d,-u,-l,-m)):this.instance?(this.instance.scale(-1,-1),this.instance.image(t,-d,-u,-l,-m)):(scale(-1,-1),image(t,-d,-u,-l,-m)),n?e.pop():this.instance?this.instance.pop():pop()):n?e.image(t,d,u,l,m):this.instance?this.instance.image(t,d,u,l,m):image(t,d,u,l,m),d+=l,d>=a){y=!0,d=this.#a.tX_anchor,u+=m;break}y=!y}x=!x}e?e.blendMode(this.instance?this.instance.BLEND:BLEND):this.instance?this.instance.blendMode(this.instance.BLEND):blendMode(BLEND),n&&e.reset()}#s(t){switch(t){case"int":this.#e=1,this.#i=this.#o;break;case"float":this.#e=0,this.#i=this.#h}}#r(t,i){return 1==this.#e?{min:Math.ceil(t),max:Math.floor(i)}:{min:t,max:i}}#o(t,i){return Math.floor(this.#t()*(i-t+1)+t)}#h(t,i){return this.#t()*(i-t)+t}}const p5grain=new P5Grain;p5.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i)},p5.Graphics.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i,this)},p5.Image.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i,this)},p5.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i)},p5.Graphics.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i,this)},p5.Image.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i,this)},p5.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i)},p5.Graphics.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i,this)},p5.Image.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i,this)},p5.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i)},p5.Graphics.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i,this)},p5.Image.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i,this)},p5.prototype.textureAnimate=function(t,i){return p5grain.textureAnimate(t,i)},p5.prototype.textureOverlay=function(t,i){return p5grain.textureOverlay(t,i)},p5.Graphics.prototype.textureOverlay=function(t,i){return p5grain.textureOverlay(t,i,this)};
